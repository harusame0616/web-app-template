# 掲示板システム要件定義

## 1. システム概要

スレッド形式の掲示板システムを構築する。ユーザーはスレッドを作成し、そのスレッドに対してコメントを投稿できる。投稿時にパスワードを設定することで、後から編集・削除が可能となる。

## 2. 機能要件

### 2.1 スレッド機能

#### 2.1.1 スレッド作成
- **必須項目**
  - タイトル（最大100文字）
  - 投稿者名（最大50文字）
  - 本文（最大2000文字）
- **任意項目**
  - パスワード（4-20文字、半角英数字）
  - 画像添付（最大4枚）
  - 動画添付（最大1本）

#### 2.1.2 スレッド一覧表示
- 最新の投稿があったスレッドから順に表示
- 1ページあたり20スレッド表示
- ページネーション機能
- 各スレッドの表示項目
  - タイトル
  - 作成者名
  - 作成日時
  - 最終投稿日時
  - コメント数

#### 2.1.3 スレッド詳細表示
- スレッド本文の表示
- 添付画像・動画の表示
- コメント一覧の表示（時系列順）

#### 2.1.4 スレッド編集
- パスワード認証が必要
- 編集可能項目
  - タイトル
  - 本文
  - 画像・動画の追加/削除

#### 2.1.5 スレッド削除
- パスワード認証が必要
- 論理削除（データは残し、表示のみ「削除されました」とする）
- 削除後もコメントは表示される

### 2.2 コメント機能

#### 2.2.1 コメント投稿
- **必須項目**
  - 投稿者名（最大50文字）
  - 本文（最大1000文字）
- **任意項目**
  - パスワード（4-20文字、半角英数字）
  - 画像添付（最大2枚）
  - 動画添付（最大1本）
- 自動付与項目
  - レス番号（スレッド内での連番）

#### 2.2.2 コメント表示
- 投稿日時の古い順に表示
- レス番号を表示
- 削除されたコメントは「削除されました」と表示

#### 2.2.3 コメント編集
- パスワード認証が必要
- 編集可能項目
  - 本文
  - 画像・動画の追加/削除

#### 2.2.4 コメント削除
- パスワード認証が必要
- 論理削除（データは残し、表示のみ「削除されました」とする）

### 2.3 メディア管理機能

#### 2.3.1 画像管理
- 対応形式：JPEG、PNG、GIF、WebP
- 最大サイズ：10MB/枚
- 保存先：Supabase Storage
- サムネイル自動生成

#### 2.3.2 動画管理
- 対応形式：MP4、WebM
- 最大サイズ：100MB/本
- 保存先：Cloudflare Stream
- ストリーミング再生対応

## 3. 非機能要件

### 3.1 パフォーマンス
- スレッド一覧：2秒以内で表示
- スレッド詳細：3秒以内で表示
- 画像アップロード：10秒以内で完了
- 動画アップロード：60秒以内で完了

### 3.2 ユーザビリティ
- レスポンシブデザイン（PC、タブレット、スマートフォン対応）
- 直感的なUI/UX
- エラーメッセージの分かりやすい表示

### 3.3 セキュリティ
- パスワードのハッシュ化（bcrypt使用）
- XSS対策（HTMLサニタイズ）
- CSRF対策（Server Actions使用）
- SQLインジェクション対策（Prisma ORM使用）

### 3.4 可用性
- 24時間365日稼働を目標
- データベースの定期バックアップ

## 4. 制約事項

### 4.1 技術的制約
- Next.js App Routerを使用
- データベースはSupabase（PostgreSQL）を使用
- 認証機能はSupabase Authを使用（メンバーエリアへのアクセス制御）

### 4.2 運用制約
- メンバー限定サイト（/member/board配下に配置）
- スパム対策は不要（認証済みユーザーのみアクセス可能）

## 5. 用語定義

| 用語 | 説明 |
|------|------|
| スレッド | 掲示板における話題の単位 |
| コメント | スレッドに対する返信 |
| レス番号 | スレッド内でのコメントの通し番号 |
| 論理削除 | データベースから物理的に削除せず、削除フラグで管理する方式 |
| パスワード認証 | 投稿時に設定したパスワードで編集・削除権限を確認する仕組み |